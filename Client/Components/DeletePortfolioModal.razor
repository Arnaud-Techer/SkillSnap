@using Client.Models

@if (ShowModal)
{
    <div class="modal-backdrop">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <h3 class="modal-title">Delete Portfolio</h3>
                <button @onclick="CloseModal" 
                        class="modal-close-button">
                    <span class="modal-close-icon">‚úï</span>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body">
                <div class="warning-section">
                    <div class="warning-icon-container">
                        <span class="warning-icon">üóëÔ∏è</span>
                    </div>
                    <h4 class="warning-title">Select Portfolio to Delete</h4>
                    <p class="warning-description">
                        Choose a portfolio from the list below. This action will permanently delete the portfolio and all associated projects and skills.
                    </p>
                </div>

                @if (Portfolios?.Any() == true)
                {
                    <div class="portfolio-list">
                        @foreach (var portfolio in Portfolios)
                        {
                            <div class="portfolio-item">
                                <input type="radio" 
                                       name="selectedPortfolio" 
                                       value="@portfolio.Id" 
                                       @onchange="@(() => SelectPortfolio(portfolio.Id))"
                                       class="portfolio-radio">
                                <div class="portfolio-content">
                                    <div class="portfolio-header">
                                        @if (!string.IsNullOrEmpty(portfolio.ProfileImageUrl))
                                        {
                                            <img src="@portfolio.ProfileImageUrl" 
                                                 alt="@portfolio.Name" 
                                                 class="portfolio-avatar">
                                        }
                                        else
                                        {
                                            <div class="portfolio-avatar-placeholder">
                                                @portfolio.Name.Substring(0, 1).ToUpper()
                                            </div>
                                        }
                                        <div class="portfolio-info">
                                            <p class="portfolio-name">@portfolio.Name</p>
                                            <p class="portfolio-stats">
                                                @portfolio.ProjectCount projects ‚Ä¢ @portfolio.SkillCount skills
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>

                    @if (selectedPortfolioId > 0)
                    {
                        <div class="confirmation-warning">
                            <div class="confirmation-warning-content">
                                <span class="confirmation-warning-icon">‚ö†Ô∏è</span>
                                <div class="confirmation-warning-text">
                                    <h5 class="confirmation-warning-title">Warning: This action cannot be undone!</h5>
                                    <p class="confirmation-warning-description">
                                        Deleting this portfolio will permanently remove all associated projects and skills from the database.
                                    </p>
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="empty-state">
                        <div class="empty-state-icon-container">
                            <span class="empty-state-icon">üìÇ</span>
                        </div>
                        <h4 class="empty-state-title">No Portfolios Found</h4>
                        <p class="empty-state-description">There are no portfolios available to delete.</p>
                    </div>
                }
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer">
                <button @onclick="CloseModal" 
                        class="btn-secondary action-button">
                    Cancel
                </button>
                <button @onclick="HandleDelete" 
                        disabled="@(selectedPortfolioId <= 0 || isDeleting)"
                        class="btn-danger action-button delete-button">
                    @if (isDeleting)
                    {
                        <span class="delete-button-spinner">‚è≥</span>
                        <span>Deleting...</span>
                    }
                    else
                    {
                        <span class="delete-button-icon">üóëÔ∏è</span>
                        <span>Delete Portfolio</span>
                    }
                </button>
            </div>
        </div>
    </div>
}

@code {
    [Parameter] public bool ShowModal { get; set; }
    [Parameter] public EventCallback OnClose { get; set; }
    [Parameter] public EventCallback<int> OnDelete { get; set; }
    [Parameter] public IEnumerable<PortfolioUserSummary>? Portfolios { get; set; }

    private int selectedPortfolioId = 0;
    private bool isDeleting = false;

    private void SelectPortfolio(int portfolioId)
    {
        selectedPortfolioId = portfolioId;
    }

    private async Task CloseModal()
    {
        selectedPortfolioId = 0;
        isDeleting = false;
        await OnClose.InvokeAsync();
    }

    private async Task HandleDelete()
    {
        if (selectedPortfolioId <= 0 || isDeleting || !OnDelete.HasDelegate)
        {
            return;
        }

        isDeleting = true;
        try
        {
            await OnDelete.InvokeAsync(selectedPortfolioId);
        }
        finally
        {
            isDeleting = false;
        }
    }
}
