@using Client.ViewModels
@inject AuthViewModel AuthViewModel

<div class="search-bar-container">
    <div class="search-container">
        <div class="search-icon">
            @if (IsSearching)
            {
                <span class="search-spinner">‚è≥</span>
            }
            else
            {
                <span class="search-icon-svg">üîç</span>
            }
        </div>
        <input type="text" 
               @bind="SearchQuery" 
               @onkeydown="HandleSearchKeyDown"
               @oninput="HandleSearchInput"
               placeholder="Search portfolios by name..." 
               disabled="@IsSearching"
               class="search-input" />
        @if (!string.IsNullOrWhiteSpace(SearchQuery))
        {
            <button @onclick="ClearSearch" class="search-clear">
                <span class="search-clear-icon">‚úï</span>
            </button>
        }
    </div>
</div>

@code {
    private string _searchQuery = string.Empty;
    
    [Parameter] 
    public string SearchQuery 
    { 
        get => _searchQuery;
        set 
        {
            _searchQuery = value;
        }
    }
    
    [Parameter] public bool IsSearching { get; set; } = false;
    [Parameter] public EventCallback<string> OnSearchQueryChanged { get; set; }
    [Parameter] public EventCallback OnSearchKeyDown { get; set; }
    [Parameter] public EventCallback OnClearSearch { get; set; }

    private async Task HandleSearchKeyDown(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            await OnSearchKeyDown.InvokeAsync();
        }
    }

    private async Task HandleSearchInput(ChangeEventArgs e)
    {
        var newValue = e.Value?.ToString() ?? string.Empty;
        SearchQuery = newValue;
        await OnSearchQueryChanged.InvokeAsync(SearchQuery);
    }

    private async Task ClearSearch()
    {
        await OnClearSearch.InvokeAsync();
    }
}
